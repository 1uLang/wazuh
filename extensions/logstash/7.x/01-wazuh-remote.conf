# Wazuh - Logstash configuration file
## Remote Wazuh Manager - Filebeat input
input {
    beats {
        port => 5000
    }
}

filter {
    json {
      source => "message"
    }
}

filter {
    if [data][srcip] {
        mutate {
            add_field => [ "@src_ip", "%{[data][srcip]}" ]
        }
    }
    if [data][aws][sourceIPAddress] {
        mutate {
            add_field => [ "@src_ip", "%{[data][aws][sourceIPAddress]}" ]
        }
    }
    if [data][win][eventdata][ipAddress] {
        mutate {
            add_field => [ "@src_ip", "%{[data][win][eventdata][ipAddress]}" ]
        }
    }
}

filter {
    date {
        match => ["timestamp", "ISO8601"]
        target => "timestamp"
    }
    mutate {
        remove_field => [ "@timestamp", "message", "beat", "input_type", "tags", "count", "@version", "ecs", "log", "offset", "type", "@src_ip", "host" ] 
    }
}
output {
    elasticsearch {
        hosts => ["localhost:9200"]
        manage_template => true
        template_overwrite => true
        template => "/etc/logstash/wazuh-template.json"
        template_name => "wazuh"
        index => "wazuh-alerts-3.x-%{+YYYY.MM.dd}"
    }
}